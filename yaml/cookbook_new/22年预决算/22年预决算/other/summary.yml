
dataset_vis:
  vis_grid:
    columns: []
    row_sort:
      sort_orders: []
      sort_by: index

dataset_pipeline:
  - push_dataset:
      key: qita
  - use_df:
      key: qita
  - df_fillna:
      columns: code_name
      value: '-'
  - df_select:
      - '[code_name] != @v1'
      - v1: '-'
  - pivot_table:
      values: money
      index: [ac_code, ac_name]
      columns: [code_name]
      aggfunc: sum

  - row_pad_value_by_index:
      index_col: ac_code
      pad_values:
        Q-1010101: 0
        Q-101010201: 0
        Q-101010202: 0
        Q-101010203: 0
        Q-101010204: 0
        Q-101010301: 0
        Q-101010302: 0
        Q-101010401: 0
        Q-101010402: 0
        Q-101010403: 0
        Q-101010404: 0
        Q-101010405: 0
        Q-101010406: 0
        Q-1010109: 0
        Q-1010105: 0
        Q-1010106: 0
        Q-1010107: 0
        Q-1010108: 0
        Q-1010201: 0
        Q-1010202: 0
        Q-1010203: 0
        Q-1010204: 0
        Q-1010205: 0
        Q-1010206: 0
        Q-1010207: 0
        Q-10201: 0
        Q-10202: 0
        Q-10203: 0
        Q-10204: 0
        Q-10205: 0
        Q-1030101: 0
        Q-1030102: 0
        Q-10302: 0
        Q-1030301: 0
        Q-1030302: 0
        Q-1030303: 0
        Q-1030304: 0
        Q-10304: 0
        Q-10305: 0
        Q-1030601: 0
        Q-1030602: 0
        Q-1030603: 0
        Q-1040101: 0
        Q-1040102: 0
        Q-1040103: 0
        Q-1040201: 0
        Q-1040202: 0
        Q-1040203: 0
        Q-201010101: 0
        Q-201010102: 0
        Q-201010103: 0
        Q-201010104: 0
        Q-201010105: 0
        Q-2010102: 0
        Q-20103: 0
        Q-2010104: 0
        Q-20102: 0
        Q-20201: 0
        Q-20202: 0
        Q-20203: 0
        Q-20204: 0
        Q-20205: 0
        Q-20206: 0
        Q-20207: 0
        Q-20301: 0
        Q-20302: 0
        Q-20303: 0
        Q-2040101: 0
        Q-2040102: 0
        Q-2040201: 0
        Q-2040202: 0
        Q-2050101: 0
        Q-2050102: 0
        Q-20502: 0
        Q-20503: 0
        Q-20601: 0
        Q-20602: 0
        Q-20603: 0
        Q-20604: 0
        Q-20605: 0
        Q-20701: 0
        Q-20702: 0
        Q-20708: 0
        Q-20709: 0
        Q-2070301: 0
        Q-2070302: 0
        Q-2070303: 0
        Q-20704: 0
        Q-20705: 0
        Q-20706: 0
        Q-20707: 0
        Q-2080101: 0
        Q-2080102: 0
        Q-2080103: 0
        Q-2080104: 0
        Q-2080105: 0
        Q-2080106: 0
        Q-2080201: 0
        Q-2080202: 0
        Q-2080301: 0
        Q-2080302: 0
        Q-2080303: 0
        Q-20804: 0
        Q-2080501: 0
        Q-2080502: 0
        Q-2080503: 0
        Q-2080504: 0
        Q-2080505: 0
        Q-2080506: 0
        Q-209: 0
        Q-210: 0
        Q-21101: 0
        Q-2110201: 0
        Q-2110202: 0
        Q-2110203: 0
        Q-21103: 0
        Q-21104: 0
        Q-21105: 0
        Q-21106: 0
        Q-21201: 0
        Q-21202: 0
        Q-21301: 0
        Q-21302: 0
        Q-21303: 0
        Q-21304: 0
        Q-214: 0
        Q-21501: 0
        Q-21502: 0
        Q-701: 0
        Q-110101: 0
        Q-11020101: 0
        Q-11020102: 0
        Q-110202: 0
        Q-110204: 0
        Q-110205: 0
        Q-110206: 0
        Q-30101: 0
        Q-700: 0

  - df_fillna:
      value: 0.0

  - row_eval_by_index:
      exp_str: |
                {{QS-1014}} = {{Q-1010101}} + {{Q-101010201}} + {{Q-101010202}} + {{Q-101010203}} + {{Q-101010204}} + {{Q-101010301}} + {{Q-101010302}} + {{Q-101010401}} + {{Q-101010402}} + {{Q-101010403}} + {{Q-101010404}} + {{Q-101010405}} + {{Q-101010406}} + {{Q-1010109}} + {{Q-1010105}} + {{Q-1010106}} + {{Q-1010107}} + {{Q-1010108}} + {{Q-1010201}} + {{Q-1010202}} + {{Q-1010203}} + {{Q-1010204}} + {{Q-1010205}} + {{Q-1010206}} + {{Q-1010207}} + {{Q-10201}} + {{Q-10202}} + {{Q-10203}} + {{Q-10204}} + {{Q-10205}} + {{Q-1030101}} + {{Q-1030102}} + {{Q-10302}} + {{Q-1030301}} + {{Q-1030302}} + {{Q-1030303}} + {{Q-1030304}} + {{Q-10304}} + {{Q-10305}} + {{Q-1030601}} + {{Q-1030602}} + {{Q-1030603}} + {{Q-1040101}} + {{Q-1040102}} + {{Q-1040103}} + {{Q-1040201}} + {{Q-1040202}} + {{Q-1040203}}
                {{QS-2014}} = {{Q-201010101}} + {{Q-201010102}} + {{Q-201010103}} + {{Q-201010104}} + {{Q-201010105}} + {{Q-2010102}} + {{Q-20103}} + {{Q-2010104}} + {{Q-20102}} + {{Q-20201}} + {{Q-20202}} + {{Q-20203}} + {{Q-20204}} + {{Q-20205}} + {{Q-20206}} + {{Q-20207}} + {{Q-20301}} + {{Q-20302}} + {{Q-20303}} + {{Q-2040101}} + {{Q-2040102}} + {{Q-2040201}} + {{Q-2040202}} + {{Q-2050101}} + {{Q-2050102}} + {{Q-20502}} + {{Q-20503}} + {{Q-20601}} + {{Q-20602}} + {{Q-20603}} + {{Q-20604}} + {{Q-20605}} + {{Q-20701}} + {{Q-20702}} + {{Q-20708}} + {{Q-20709}} + {{Q-2070301}} + {{Q-2070303}} + {{Q-2070302}} + {{Q-20704}} + {{Q-20705}} + {{Q-20706}} + {{Q-20707}} + {{Q-2080101}} + {{Q-2080102}} + {{Q-2080103}} + {{Q-2080104}} + {{Q-2080105}} + {{Q-2080106}} + {{Q-2080201}} + {{Q-2080202}} + {{Q-2080301}} + {{Q-2080302}} + {{Q-2080303}} + {{Q-20804}} + {{Q-2080501}} + {{Q-2080502}} + {{Q-2080503}} + {{Q-2080504}} + {{Q-2080505}} + {{Q-2080506}} + {{Q-209}} + {{Q-210}} + {{Q-21101}} + {{Q-2110201}} + {{Q-2110202}} + {{Q-2110203}} + {{Q-21103}} + {{Q-21104}} + {{Q-21105}} + {{Q-21106}} + {{Q-21201}} + {{Q-21202}} + {{Q-21301}} + {{Q-21302}} + {{Q-21303}} + {{Q-214}} + {{Q-21304}} + {{Q-21501}} + {{Q-21502}} + {{Q-110101}} + {{Q-11020101}} + {{Q-11020102}} + {{Q-110202}} + {{Q-110204}} + {{Q-110205}} + {{Q-110206}} + {{Q-30101}}
                {{QS-7010}} = {{Q-701}} + {{Q-700}}

      index_col: ac_code
      exclude_cols: [ac_name]
      target_rows:
        - index: QS-1014
          cols:
            ac_name: 主营业务收入
        - index: QS-2014
          cols:
            ac_name: 主营业务成本
        - index: QS-7010
          cols:
            ac_name: 营业外收入-code
  - sort_by_index:
      sort_list: [QS-1014, QS-2014, QS-7010]

  - stash_push_df: []

  - use_df:
      key: qita
  - df_fillna:
      columns: team_name
      value: '-'
  - df_select:
      - '[team_name] != @v1'
      - v1: '-'
  - pivot_table:
      values: money
      index: [ac_code, ac_name]
      columns: [team_name]
      aggfunc: sum

  - row_pad_value_by_index:
      index_col: ac_code
      pad_values:
        Q-30108: 0
        Q-30102: 0
        Q-30103: 0
        Q-30104: 0
        Q-30105: 0
        Q-30106: 0
        Q-30109: 0
        Q-30107: 0
        Q-3020101: 0
        Q-3020102: 0
        Q-30202: 0
        Q-30203: 0
        Q-30204: 0
        Q-30205: 0
        Q-30206: 0
        Q-30207: 0
        Q-30208: 0
        Q-30209: 0
        Q-30210: 0
        Q-30211: 0
        Q-30212: 0
        Q-30301: 0
        Q-30302: 0
        Q-3030201: 0
        Q-3030202: 0
        Q-3030203: 0
        Q-30303: 0
        Q-400: 0
        Q-401: 0
        Q-402: 0
        Q-403: 0
        Q-404: 0
        Q-500: 0
        Q-600: 0
        Q-700: 0
        Q-800: 0
        Q-900: 0

  - df_fillna:
      value: 0.0

  - row_eval_by_index:
      exp_str: |
                {{QS-3013}} = {{Q-30108}} + {{Q-30102}} + {{Q-30103}} + {{Q-30104}} + {{Q-30105}} + {{Q-30106}} + {{Q-30109}} + {{Q-30107}} + {{Q-3020101}} + {{Q-3020102}} + {{Q-30202}} + {{Q-30203}} + {{Q-30204}} + {{Q-30205}} + {{Q-30206}} + {{Q-30207}} + {{Q-30208}} + {{Q-30209}} + {{Q-30210}} + {{Q-30211}} + {{Q-30212}} + {{Q-30301}} + {{Q-30302}} + {{Q-30303}}
                {{QS-4014}} = {{Q-400}} + {{Q-401}} + {{Q-402}} + {{Q-403}} + {{Q-404}}
      index_col: ac_code
      exclude_cols: [ac_name]
      target_rows:
        - index: QS-3013
          cols:
            ac_name: 管理费用
        - index: QS-4014
          cols:
            ac_name: 财务费用
        - index: Q-500
          cols:
            ac_name: 资产减值损失
        - index: Q-600
          cols:
            ac_name: 投资收益
        - index: Q-700
          cols:
            ac_name: 营业外收入-team
        - index: Q-800
          cols:
            ac_name: 营业外支出
        - index: Q-900
          cols:
            ac_name: 所得税

  - sort_by_index:
      sort_list: [QS-3013, QS-4014, Q-500, Q-600, Q-700, Q-800, Q-900]

  - stash_push_df: []
  - stash_concat_df:
      drop_stash: true

  - row_money_format_by_index:
      index_rows: [QS-1014, QS-2014, QS-7010, QS-3013, QS-4014, Q-500, Q-600, Q-700, Q-800, Q-900]

#  - run_py:
#      - |
#        df = to_df(df).copy()
#        df = df.drop(['ac_code'],axis = 1)
#        df = df.set_index(['ac_name'])
#        df = df.transpose().reset_index(drop=False)
#        result = to_dd(df)
#
#  - df_rename_columns:
#      - index: code/team名称
#
#  - fetch_cols:
#      columns: [code/team名称, 主营业务收入, 主营业务成本, 营业外收入-code, 管理费用, 财务费用, 资产减值损失, 投资收益, 营业外收入-team, 营业外支出, 所得税]
#
#  - sort_by_columns:
#      sort_list: [code/team名称, 主营业务收入, 主营业务成本, 营业外收入-code, 管理费用, 财务费用, 资产减值损失, 投资收益, 营业外收入-team, 营业外支出, 所得税]

  - sort_by_index:
      sort_list: [QS-1014, QS-2014, QS-7010, QS-3013, QS-4014, Q-500, Q-600, Q-700, Q-800, Q-900]

  - df_rename_columns:
      - ac_code: 科目编号
        ac_name: 科目名称

  - run_py:
      - |
        df = to_df(df)
        df = df.drop(['科目编号'],axis = 1)
        result = df

  - sort_by_columns:
      sort_list: [科目名称]

datasource:
  query: {}
  datasource_type: qcode_biz_dataset

